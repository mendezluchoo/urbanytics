# üèôÔ∏è Urbanytics - An√°lisis Inmobiliario Inteligente

**Urbanytics** es una aplicaci√≥n web full-stack para el an√°lisis inteligente del mercado inmobiliario. La plataforma permite explorar propiedades, visualizar tendencias de mercado, obtener predicciones de precios con IA, y gestionar usuarios con un sistema completo de autenticaci√≥n y administraci√≥n.

## ‚ú® Caracter√≠sticas Principales

### ü§ñ Machine Learning & IA
- **Predicci√≥n de Precios**: Modelo de Random Forest para estimar valores de mercado
- **An√°lisis Inteligente**: Factores din√°micos basados en datos hist√≥ricos
- **Confianza del Modelo**: Score de confianza para cada predicci√≥n
- **Variables Autom√°ticas**: C√°lculo autom√°tico de ratios y tiempos de venta
- **Interfaz Intuitiva**: Formulario inteligente con validaciones y estados condicionales

### üîê Sistema de Autenticaci√≥n
- **Registro de Usuarios**: Formulario completo con validaciones
- **Login Seguro**: Autenticaci√≥n con JWT y bcrypt
- **Roles de Usuario**: Admin y Usuario con permisos diferenciados
- **Protecci√≥n de Rutas**: Middleware de autenticaci√≥n
- **Gesti√≥n de Sesiones**: Tokens seguros con expiraci√≥n

### üë®‚Äçüíº Panel de Administraci√≥n
- **Dashboard Completo**: KPIs en tiempo real y gesti√≥n avanzada
- **CRUD de Propiedades**: Crear, editar, eliminar y filtrar propiedades
- **Gesti√≥n de Usuarios**: Administrar usuarios del sistema
- **Filtros Avanzados**: B√∫squeda por m√∫ltiples criterios
- **Paginaci√≥n Inteligente**: Navegaci√≥n eficiente de grandes datasets
- **Estados de Propiedades**: Available/Sold con filtros espec√≠ficos

### üìä Dashboard Anal√≠tico
- **KPIs Principales**: 6 m√©tricas clave del mercado inmobiliario
- **Gr√°ficos Interactivos**: 6 visualizaciones con filtros por tipo de propiedad
- **An√°lisis Comparativo**: Tendencias temporales y distribuci√≥n geogr√°fica
- **Filtros Avanzados**: Por tipo de propiedad con actualizaci√≥n en tiempo real

### üè† Gesti√≥n de Propiedades
- **Listado Avanzado**: Paginaci√≥n, filtros m√∫ltiples y ordenamiento
- **B√∫squeda Inteligente**: Por ciudad, tipo, precio, ratio de venta, tiempo hasta venta
- **Detalles Completos**: Informaci√≥n completa de cada propiedad
- **Navegaci√≥n Fluida**: Interfaz responsive con efectos visuales

### üé® Interfaz Moderna y Minimalista
- **Paleta de Colores Uniforme**: Tonos pasteles suaves y profesionales
- **Dise√±o Minimalista**: Colores relajados y responsive
- **Contrastes Optimizados**: M√°xima legibilidad en todos los elementos
- **Efectos Interactivos**: Hover effects en todos los elementos clickeables
- **Gr√°ficos Expandibles**: Modal overlay para visualizaci√≥n detallada
- **Navegaci√≥n Intuitiva**: Barra de navegaci√≥n simplificada

## üõ†Ô∏è Stack Tecnol√≥gico

### Frontend
- **React 18** con TypeScript
- **Vite** para desarrollo r√°pido
- **Recharts** para visualizaciones
- **React Router DOM** para navegaci√≥n
- **Axios** para comunicaci√≥n con APIs
- **JWT** para manejo de tokens

### BFF (Backend for Frontend) üöÄ
- **Node.js** con Express
- **PostgreSQL** con pgxpool
- **Redis** para cach√© distribuido
- **JWT** para autenticaci√≥n
- **bcrypt** para hash de contrase√±as
- **Cach√© inteligente** con fallback a memoria
- **Rate limiting** y seguridad con Helmet
- **Compresi√≥n** autom√°tica de respuestas
- **Logging** estructurado con Morgan

### Machine Learning Service ü§ñ
- **Python** con Flask
- **Scikit-learn** para modelos de ML
- **Random Forest Regressor** para predicciones
- **Pickle** para persistencia de modelos
- **Docker** para containerizaci√≥n

### Backend Original (Legacy)
- **Go** con Gin framework
- **PostgreSQL** con pgxpool
- **CORS** habilitado
- **Arquitectura RESTful**

### Base de Datos
- **PostgreSQL** con Docker
- **Redis** para cach√© (opcional)
- **Datos**: Ventas inmobiliarias 2001-2020
- **Optimizaci√≥n**: √çndices y consultas eficientes
- **Autenticaci√≥n**: Tabla de usuarios con roles

## üöÄ Instalaci√≥n y Uso

### Prerrequisitos
- Docker y Docker Compose
- Go 1.21+ (para desarrollo backend)
- Node.js 18+ (para desarrollo frontend)
- Python 3.8+ (para ML service)

### 1. Clonar el Repositorio
```bash
git clone <repository-url>
cd urbanytics
```

### 2. Configurar Base de Datos
```bash
# Levantar PostgreSQL
docker-compose up -d

# Cargar datos (opcional - ya incluidos)
python load_data.py

# Limpiar datos (recomendado para mejor calidad)
python clean_data_complete.py
```

### 3. Configurar Autenticaci√≥n
```bash
# Crear tabla de usuarios (ejecutar en PostgreSQL)
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(20) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4. Ejecutar BFF (Recomendado)
```bash
# Instalar dependencias del BFF
cd bff
npm install

# Configurar variables de entorno
cp env.example .env

# Ejecutar BFF
npm run dev
```

### 5. Ejecutar ML Service
```bash
# Instalar dependencias del ML service
cd ml_service
pip install -r requirements.txt

# Ejecutar ML service
python app.py
```

### 6. Ejecutar Backend Original (Opcional)
```bash
cd backend
go run main.go
```

### 7. Ejecutar Frontend
```bash
cd frontend
npm install
npm run dev
```

### 8. Acceder a la Aplicaci√≥n
- **Frontend**: http://localhost:5173
- **BFF API**: http://localhost:3001
- **ML Service**: http://localhost:5000
- **Backend Original**: http://localhost:8080 (legacy)

## üîê Sistema de Autenticaci√≥n

### Roles de Usuario
- **Admin**: Acceso completo al panel de administraci√≥n
- **Usuario**: Acceso a funcionalidades b√°sicas

### Endpoints de Autenticaci√≥n
- `POST /api/auth/register` - Registro de usuarios
- `POST /api/auth/login` - Login de usuarios
- `GET /api/auth/profile` - Perfil del usuario
- `POST /api/auth/logout` - Logout

### Credenciales de Demo
- **Admin**: admin@urbanytics.com / admin123
- **Usuario**: user@urbanytics.com / user123

## ü§ñ Machine Learning

### Funcionalidades del Modelo
- **Predicci√≥n de Precios**: Estimaci√≥n basada en m√∫ltiples factores
- **Variables Analizadas**: Tipo de propiedad, ubicaci√≥n, a√±o, valor tasado
- **Confianza del Modelo**: Score de confianza para cada predicci√≥n
- **Factores Din√°micos**: An√°lisis autom√°tico de variables relevantes

### Endpoints ML
- `POST /api/ml/predict` - Predicci√≥n de precio
- `GET /api/ml/model/info` - Informaci√≥n del modelo
- `GET /api/ml/data/stats` - Estad√≠sticas de datos

## üë®‚Äçüíº Panel de Administraci√≥n

### Funcionalidades del Admin Dashboard
- **Gesti√≥n de Propiedades**: CRUD completo con filtros avanzados
- **Gesti√≥n de Usuarios**: Administrar usuarios del sistema
- **KPIs en Tiempo Real**: M√©tricas actualizadas del mercado
- **Filtros Avanzados**: B√∫squeda por m√∫ltiples criterios
- **Paginaci√≥n Inteligente**: Navegaci√≥n eficiente
- **Estados de Propiedades**: Available/Sold con filtros espec√≠ficos

### Endpoints Admin
- `GET /api/admin/properties` - Listado de propiedades
- `POST /api/admin/properties` - Crear propiedad
- `PUT /api/admin/properties/:id` - Actualizar propiedad
- `DELETE /api/admin/properties/:id` - Eliminar propiedad
- `GET /api/admin/users` - Listado de usuarios
- `PUT /api/admin/users/:id` - Actualizar usuario
- `DELETE /api/admin/users/:id` - Eliminar usuario

## üìä Funcionalidades del Dashboard

### KPIs Principales
1. **Total de Propiedades**: Volumen total del mercado
2. **Precio Promedio**: Valor t√≠pico de las propiedades
3. **Ratio de Venta Promedio**: Relaci√≥n precio de venta vs tasado
4. **Tiempo Promedio hasta Venta**: Velocidad del mercado
5. **Ciudad M√°s Activa**: Mayor volumen de transacciones
6. **Tipo M√°s Popular**: Propiedad m√°s demandada

### Gr√°ficos Anal√≠ticos
1. **Precio Promedio por Ciudad**: An√°lisis geogr√°fico
2. **An√°lisis por Tipo de Propiedad**: Segmentaci√≥n del mercado
3. **Tendencias Anuales**: Evoluci√≥n temporal
4. **Distribuci√≥n de Ratio de Venta**: Categorizaci√≥n de transacciones
5. **Distribuci√≥n de Tiempo hasta Venta**: Velocidad de mercado
6. **Top 10 Ciudades por Volumen**: Mercados m√°s activos

## üîç Filtros Avanzados

### PropertyList
- **Ciudad**: Dropdown con todas las ciudades disponibles
- **Tipo de Propiedad**: Dropdown con tipos √∫nicos
- **Tipo Residencial**: Condicional (solo para propiedades residenciales)
- **A√±o de Listado**: Filtro por a√±o
- **Ratio de Venta**: Rango personalizable
- **A√±os hasta Venta**: Rango personalizable
- **Ordenamiento**: Por precio, a√±o, ratio, tiempo, ciudad

### Dashboard
- **Tipo de Propiedad**: Filtro universal que aplica a todos los gr√°ficos
- **Actualizaci√≥n en Tiempo Real**: Todos los KPIs y gr√°ficos se actualizan

### Admin Dashboard
- **Filtros M√∫ltiples**: Ciudad, tipo, precio, estado, ratio, tiempo
- **Paginaci√≥n Avanzada**: Navegaci√≥n eficiente de grandes datasets
- **Ordenamiento**: Por cualquier campo
- **B√∫squeda en Tiempo Real**: Filtros que se aplican instant√°neamente

## üé® Caracter√≠sticas de UX/UI

### Paleta de Colores Minimalista
- **Colores Primarios**: Grises suaves y p√∫rpura pastel
- **Colores Pasteles**: Azul, verde, p√∫rpura, rosa, amarillo, naranja
- **Contrastes Optimizados**: Negro suave para texto principal
- **Sombras Sutiles**: Efectos visuales no intrusivos

### Efectos Visuales
- **Hover Effects**: Elevaci√≥n y sombras en elementos interactivos
- **Transiciones Suaves**: Animaciones de 0.2s en todos los elementos
- **Responsive Design**: Adaptable a todos los dispositivos
- **Estados Condicionales**: Campos que se habilitan/deshabilitan seg√∫n contexto

### Interactividad
- **Gr√°ficos Clickables**: Expansi√≥n en modal overlay
- **Tooltips Informativos**: Informaci√≥n detallada en hover
- **Navegaci√≥n Fluida**: Transiciones entre p√°ginas
- **Feedback Visual**: Estados de carga y error
- **Validaciones en Tiempo Real**: Feedback inmediato en formularios

## üìÅ Estructura del Proyecto

```
urbanytics/
‚îú‚îÄ‚îÄ frontend/                 # Aplicaci√≥n React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes principales
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminDashboard.tsx    # Panel de administraci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminLogin.tsx        # Login de administrador
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MachineLearning.tsx   # Predicciones ML
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LandingPage.tsx       # P√°gina principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Register.tsx          # Registro de usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                   # Otros componentes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/         # Servicios de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx          # Componente ra√≠z
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.tsx         # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ public/              # Assets est√°ticos
‚îÇ   ‚îî‚îÄ‚îÄ index.html           # HTML principal
‚îú‚îÄ‚îÄ bff/                     # Backend for Frontend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/          # Configuraci√≥n DB y Redis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # Servicios de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Rutas de la API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js      # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js     # Panel de administraci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ml.js        # Machine Learning
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...          # Otras rutas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js         # Servidor principal
‚îÇ   ‚îú‚îÄ‚îÄ package.json         # Dependencias Node.js
‚îÇ   ‚îú‚îÄ‚îÄ env.example          # Variables de entorno
‚îÇ   ‚îî‚îÄ‚îÄ README.md            # Documentaci√≥n del BFF
‚îú‚îÄ‚îÄ ml_service/              # Servicio de Machine Learning
‚îÇ   ‚îú‚îÄ‚îÄ app.py              # Servidor Flask
‚îÇ   ‚îú‚îÄ‚îÄ models/             # Modelos entrenados
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt    # Dependencias Python
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile          # Containerizaci√≥n
‚îú‚îÄ‚îÄ backend/                 # API Go (Legacy)
‚îÇ   ‚îî‚îÄ‚îÄ main.go             # Servidor principal
‚îú‚îÄ‚îÄ postgres-data/          # Datos de PostgreSQL
‚îú‚îÄ‚îÄ load_data.py            # Script de carga de datos
‚îú‚îÄ‚îÄ clean_data_complete.py  # Script de limpieza completa
‚îú‚îÄ‚îÄ migrate-to-bff.md       # Gu√≠a de migraci√≥n
‚îî‚îÄ‚îÄ docker-compose.yml      # Configuraci√≥n Docker
```

## üßπ Limpieza de Datos

### Script de Limpieza Completa (`clean_data_complete.py`)

El proyecto incluye un script comprehensivo que realiza todas las operaciones de limpieza necesarias para garantizar la calidad de los datos:

#### Operaciones de Limpieza
1. **Limpieza B√°sica**: Eliminaci√≥n de valores nulos en columnas cr√≠ticas
2. **Limpieza de Precios**: Eliminaci√≥n de precios <= 0 y outliers extremos
3. **Limpieza de Ratio de Venta**: Validaci√≥n de ratios > 0 y eliminaci√≥n de outliers
4. **Limpieza de Tiempo**: Eliminaci√≥n de tiempos negativos y > 20 a√±os
5. **Limpieza de Fechas**: Conversi√≥n y validaci√≥n de fechas
6. **Limpieza de Tipos**: Eliminaci√≥n de 'Nan' en Property Type y Residential Type
7. **Limpieza de Ciudades**: Eliminaci√≥n de ciudades vac√≠as y problem√°ticas
8. **Limpieza de A√±os**: Validaci√≥n de a√±os entre 2000-2020
9. **Limpieza de Direcciones**: Eliminaci√≥n de direcciones vac√≠as
10. **Limpieza de Valores Avaluados**: Eliminaci√≥n de valores <= 0
11. **Eliminaci√≥n de Duplicados**: Basado en Serial Number
12. **Conversi√≥n de Tipos**: Tipos de datos apropiados
13. **Renombrado de Columnas**: Formato snake_case

#### Uso
```bash
# Ejecutar limpieza completa
python clean_data_complete.py
```

#### Beneficios
- **Calidad de Datos**: Eliminaci√≥n de registros problem√°ticos
- **Consistencia**: Tipos de datos uniformes
- **Precisi√≥n**: An√°lisis m√°s confiables
- **Rendimiento**: Consultas m√°s eficientes

## üîß API Endpoints

### BFF (Recomendado) - Puerto 3001

#### Autenticaci√≥n
- `POST /api/auth/register` - Registro de usuarios
- `POST /api/auth/login` - Login de usuarios
- `GET /api/auth/profile` - Perfil del usuario
- `POST /api/auth/logout` - Logout

#### Propiedades
- `GET /api/properties` - Listado con filtros y paginaci√≥n optimizada
- `GET /api/properties/:id` - Detalle de propiedad con cach√©
- `GET /api/properties/filters/all` - Todos los filtros en una petici√≥n
- `POST /api/properties/search` - B√∫squeda avanzada con m√∫ltiples criterios

#### Analytics
- `GET /api/analytics/dashboard` - Dashboard completo con todos los datos
- `GET /api/analytics/kpis` - KPIs principales con cach√©
- `GET /api/analytics/charts/all` - Todos los gr√°ficos en una petici√≥n
- `GET /api/analytics/charts/avg-price-by-town` - Precios por ciudad
- `GET /api/analytics/charts/property-type-analysis` - An√°lisis por tipo
- `GET /api/analytics/charts/yearly-trends` - Tendencias anuales
- `GET /api/analytics/charts/sales-ratio-distribution` - Distribuci√≥n de ratios
- `GET /api/analytics/charts/time-to-sell-distribution` - Tiempo hasta venta
- `GET /api/analytics/charts/top-cities-by-volume` - Top ciudades

#### Machine Learning
- `POST /api/ml/predict` - Predicci√≥n de precio de propiedad
- `GET /api/ml/model/info` - Informaci√≥n del modelo ML
- `GET /api/ml/data/stats` - Estad√≠sticas de datos de entrenamiento

#### Administraci√≥n
- `GET /api/admin/properties` - Listado de propiedades para admin
- `POST /api/admin/properties` - Crear nueva propiedad
- `PUT /api/admin/properties/:id` - Actualizar propiedad
- `DELETE /api/admin/properties/:id` - Eliminar propiedad
- `GET /api/admin/users` - Listado de usuarios
- `PUT /api/admin/users/:id` - Actualizar usuario
- `DELETE /api/admin/users/:id` - Eliminar usuario

#### Monitoreo
- `GET /health` - Health check del sistema
- `GET /info` - Informaci√≥n del servicio

### Machine Learning Service - Puerto 5000

#### ML Endpoints
- `POST /predict` - Predicci√≥n de precio
- `GET /model/info` - Informaci√≥n del modelo
- `GET /data/stats` - Estad√≠sticas de datos
- `GET /health` - Health check del servicio

### Backend Original (Legacy) - Puerto 8080

#### Propiedades
- `GET /properties` - Listado con filtros y paginaci√≥n
- `GET /properties/:id` - Detalle de propiedad
- `GET /cities` - Lista de ciudades
- `GET /property-types` - Tipos de propiedad
- `GET /residential-types` - Tipos residenciales

#### Analytics
- `GET /analytics/kpis` - KPIs principales
- `GET /analytics/avg-price-by-town` - Precios por ciudad
- `GET /analytics/property-type-analysis` - An√°lisis por tipo
- `GET /analytics/yearly-trends` - Tendencias anuales
- `GET /analytics/sales-ratio-distribution` - Distribuci√≥n de ratios
- `GET /analytics/time-to-sell-distribution` - Tiempo hasta venta
- `GET /analytics/top-cities-by-volume` - Top ciudades

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üìû Contacto

Para preguntas o soporte, contacta al equipo de desarrollo.

## üöÄ Migraci√≥n al BFF

Para migrar el frontend al nuevo BFF optimizado, sigue la gu√≠a completa en [`migrate-to-bff.md`](./migrate-to-bff.md).

### Beneficios de la Migraci√≥n
- **70-80% menos peticiones HTTP** al servidor
- **Respuestas 3-5x m√°s r√°pidas** con cach√© autom√°tico
- **C√≥digo m√°s limpio** y mantenible en el frontend
- **Mejor escalabilidad** con cach√© distribuido
- **Monitoreo avanzado** con health checks
- **Autenticaci√≥n completa** con JWT
- **Machine Learning integrado** para predicciones

### Arquitectura Final
```
Frontend (React) ‚Üí BFF (Node.js) ‚Üí PostgreSQL + Redis
                ‚Üì
            ML Service (Python)
```

---

**Urbanytics** - Transformando datos inmobiliarios en insights accionables con IA üè†üìäü§ñ
